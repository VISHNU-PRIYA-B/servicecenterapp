// services/api.ts
import axios from "axios";

const API_URL = "http://192.168.68.124:8003/graphql/";

const axiosInstance = axios.create({
  baseURL: API_URL,
  headers: {
    Accept: "application/json",
    "Content-Type": "application/json",
  },
});

export const setAuthToken = (token?: string) => {
  if (token) {
    axiosInstance.defaults.headers.common["Authorization"] = `JWT ${token}`;
    console.log("Token set in Axios headers:", token);
  } else {
    delete axiosInstance.defaults.headers.common["Authorization"];
    console.log("Token removed from Axios headers");
  }
};

// Pass token explicitly to ensure every request includes it
export const graphqlRequest = async (query: string, variables: object = {}, token?: string) => {
  const headers: any = {};
  if (token) headers["Authorization"] = `JWT ${token}`;

  try {
    const response = await axiosInstance.post("", { query, variables }, { headers });
    if (response.data.errors) {
      throw new Error(response.data.errors.map((e: any) => e.message).join(" | "));
    }
    return response.data.data;
  } catch (error: any) {
    console.error("GraphQL Request Error:", error.response?.data || error.message);
    throw error;
  }
};

export default axiosInstance;
 
